STANDARD_FLAGS=--std=c11 -g
WARNING_FLAGS=-Wall -pedantic
OPT_FLAGS=-O2 -fno-omit-frame-pointer

CLASSIC_COMPILE_FLAGS=-fPIC -fPIE
CLASSIC_LINK_FLAGS=-pie -rdynamic -Wl,--no-as-needed

COMPILE_FLAGS:=${STANDARD_FLAGS} ${WARNING_FLAGS} ${OPT_FLAGS}
LINKER_FLAGS=-lm
TARGET=workload
CLASSIC_TARGET=workload_classic
SRC=workload.c

ALL_TARGETS=${TARGET} ${CLASSIC_TARGET}

all: ${ALL_TARGETS}
.PHONY: all

${TARGET}: ${SRC} Makefile
	gcc ${COMPILE_FLAGS} ${SRC} -o $@ ${LINKER_FLAGS}

${CLASSIC_TARGET}: ${SRC} Makefile
	gcc ${COMPILE_FLAGS} ${CLASSIC_COMPILE_FLAGS} ${SRC} -o $@ ${CLASSIC_LINK_FLAGS} ${LINKER_FLAGS}

clean:
	rm -rf ${ALL_TARGETS}
.PHONY: clean
