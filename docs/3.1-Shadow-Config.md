Shadow uses the standard YAML format to accept configuration options from users. Examples of a Shadow configuration file, `shadow.config.yaml`, are distributed with the release. The following describes Shadow's YAML format that can be used to customize a simulation.

Example:

```yaml
general:
  stop_time: 2 min
topology: plain
hosts:
  server:
    processes:
    - path: /usr/sbin/nginx
      args: -c ../../../nginx.conf -p .
      start_time: 1
  client:
    quantity: 20
    processes:
    - path: /usr/bin/curl
      args: server --silent
      start_time: 5
```

## Contents:

- [`general`](#general)
- [`general.bootstrap_end_time`](#generalbootstrap_end_time)
- [`general.data_directory`](#generaldata_directory)
- [`general.heartbeat_interval`](#generalheartbeat_interval)
- [`general.log_level`](#generallog_level)
- [`general.seed`](#generalseed)
- [`general.stop_time`](#generalstop_time)
- [`general.template_directory`](#generaltemplate_directory)
- [`general.workers`](#generalworkers)
- [`topology`](#topology)
- [`experimental`](#experimental)
- [`experimental.interface_buffer`](#experimentalinterface_buffer)
- [`experimental.interface_qdisc`](#experimentalinterface_qdisc)
- [`experimental.interpose_method`](#experimentalinterpose_method)
- [`experimental.max_concurrency`](#experimentalmax_concurrency)
- [`experimental.preload_spin_max`](#experimentalpreload_spin_max)
- [`experimental.runahead`](#experimentalrunahead)
- [`experimental.scheduler_policy`](#experimentalscheduler_policy)
- [`experimental.socket_recv_autotune`](#experimentalsocket_recv_autotune)
- [`experimental.socket_recv_buffer`](#experimentalsocket_recv_buffer)
- [`experimental.socket_send_autotune`](#experimentalsocket_send_autotune)
- [`experimental.socket_send_buffer`](#experimentalsocket_send_buffer)
- [`experimental.use_cpu_pinning`](#experimentaluse_cpu_pinning)
- [`experimental.use_explicit_block_message`](#experimentaluse_explicit_block_message)
- [`experimental.use_memory_manager`](#experimentaluse_memory_manager)
- [`experimental.use_o_n_waitpid_workarounds`](#experimentaluse_o_n_waitpid_workarounds)
- [`experimental.use_object_counters`](#experimentaluse_object_counters)
- [`experimental.use_sched_fifo`](#experimentaluse_sched_fifo)
- [`experimental.use_shim_syscall_handler`](#experimentaluse_shim_syscall_handler)
- [`experimental.use_syscall_counters`](#experimentaluse_syscall_counters)
- [`host_defaults`](#host_defaults)
- [`host_defaults.bandwidth_down`](#host_defaultsbandwidth_down)
- [`host_defaults.bandwidth_up`](#host_defaultsbandwidth_up)
- [`host_defaults.city_code_hint`](#host_defaultscity_code_hint)
- [`host_defaults.country_code_hint`](#host_defaultscountry_code_hint)
- [`host_defaults.heartbeat_interval`](#host_defaultsheartbeat_interval)
- [`host_defaults.heartbeat_log_info`](#host_defaultsheartbeat_log_info)
- [`host_defaults.heartbeat_log_level`](#host_defaultsheartbeat_log_level)
- [`host_defaults.ip_hint`](#host_defaultsip_hint)
- [`host_defaults.log_level`](#host_defaultslog_level)
- [`host_defaults.pcap_directory`](#host_defaultspcap_directory)
- [`hosts`](#hosts)
- [`hosts.<hostname>.options`](#hostshostnameoptions)
- [`hosts.<hostname>.quantity`](#hostshostnamequantity)
- [`hosts.<hostname>.processes`](#hostshostnameprocesses)
- [`hosts.<hostname>.processes[*].args`](#hostshostnameprocessesargs)
- [`hosts.<hostname>.processes[*].environment`](#hostshostnameprocessesenvironment)
- [`hosts.<hostname>.processes[*].path`](#hostshostnameprocessespath)
- [`hosts.<hostname>.processes[*].quantity`](#hostshostnameprocessesquantity)
- [`hosts.<hostname>.processes[*].start_time`](#hostshostnameprocessesstart_time)
- [`hosts.<hostname>.processes[*].stop_time`](#hostshostnameprocessesstop_time)

#### `general`

*Required*

General experiment settings.

#### `general.bootstrap_end_time`

Default: "0 sec"  
Type: String OR Integer

#### `general.data_directory`

Default: "shadow.data"  
Type: String

Path to store simulation output.

#### `general.heartbeat_interval`

Default: "1 sec"  
Type: String OR Integer

Interval at which to print heartbeat messages.

#### `general.log_level`

Default: "info"  
Type: "error" OR "warning" OR "info" OR "debug" OR "trace"

Log level of output written on stdout. If Shadow was built in release mode, then messages at level 'trace' will always be dropped.

#### `general.seed`

Default: 1  
Type: Integer

Initialize randomness using seed N.

#### `general.stop_time`

*Required*  
Type: String OR Integer

The simulated time at which simulated processes are sent a SIGKILL signal.

#### `general.template_directory`

Default: null  
Type: String OR null

Path to recursively copy during startup and use as the data-directory.

#### `general.workers`

Default: 0  
Type: Integer

Run concurrently with N worker threads.

#### `topology`

*Required*  
Type: "plain" OR "graphml" OR "path"

The topology can be specified as a built-in "plain" topology with a single node, an inline GraphML string, or a path to an external GraphML file.

The topology, a collection of nodes and edges that represent a network topology, should hold an undirected, connected graph with certain attributes specified on the nodes and edges. For more information on how to structure this data, see the [Topology Format](3.2-Network-Config.md).

If the path begins with `~/`, it will be considered relative to the current user's home directory.

Example:

```yaml
topology:
  graphml: |-
    <?xml version="1.0" encoding="utf-8"?>
    <graphml>
      ...
    </graphml>
```

#### `experimental`

Experimental experiment settings. Unstable and may change or be removed at any time, regardless of Shadow version.

#### `experimental.interface_buffer`

Default: "1024000 B"  
Type: String OR Integer

Size of the interface receive buffer that accepts incoming packets.

#### `experimental.interface_qdisc`

Default: "fifo"  
Type: "fifo" OR "roundrobin"

The queueing discipline to use at the network interface.

#### `experimental.interpose_method`

Default: "ptrace"  
Type: "ptrace" OR "preload" OR "hybrid"

Which interposition method to use.

#### `experimental.max_concurrency`

Default: null  
Type: Integer OR null

Maximum number of workers to allow to run at once.

#### `experimental.preload_spin_max`

Default: 8096  
Type: Integer

Max number of iterations to busy-wait on IPC semaphore before blocking.

#### `experimental.runahead`

Default: null  
Type: String OR null

If set, overrides the automatically calculated minimum time workers may run ahead when sending events between nodes.

#### `experimental.scheduler_policy`

Default: "steal"  
Type: "host" OR "steal" OR "thread" OR "threadxthread" OR "threadxhost"

The event scheduler's policy for thread synchronization.

#### `experimental.socket_recv_autotune`

Default: true  
Type: Bool

Enable receive window autotuning.

#### `experimental.socket_recv_buffer`

Default: "174760 B"  
Type: String OR Integer

Initial size of the socket's receive buffer.

#### `experimental.socket_send_autotune`

Default: true  
Type: Bool

Enable send window autotuning.

#### `experimental.socket_send_buffer`

Default: "131072 B"  
Type: String OR Integer

Initial size of the socket's send buffer.

#### `experimental.use_cpu_pinning`

Default: false  
Type: Bool

Use CPU pinning.

#### `experimental.use_explicit_block_message`

Default: true  
Type: Bool

Send message to plugin telling it to stop spinning when a syscall blocks.

#### `experimental.use_memory_manager`

Default: true  
Type: Bool

Use the MemoryManager. It can be useful to disable for debugging, but will hurt performance in most cases.

#### `experimental.use_o_n_waitpid_workarounds`

Default: true  
Type: Bool

Enable performance workarounds for waitpid being O(n). Beneficial to disable if waitpid is patched to be O(1) or in some cases where it'd otherwise result in excessive detaching and reattaching.

#### `experimental.use_object_counters`

Default: true  
Type: Bool

Count object allocations and deallocations. If disabled, we will not be able to detect object memory leaks.

#### `experimental.use_sched_fifo`

Default: false  
Type: Bool

Use the SCHED_FIFO scheduler. Requires CAP_SYS_NICE. See sched(7), capabilities(7).

#### `experimental.use_shim_syscall_handler`

Default: true  
Type: Bool

Use shim-side syscall handler to force hot-path syscalls to be handled via an inter-process syscall with Shadow.

#### `experimental.use_syscall_counters`

Default: false  
Type: Bool

Count the number of occurrences for individual syscalls.

#### `host_defaults`

Default options for all hosts. These options can also be overridden for each host individually.

#### `host_defaults.bandwidth_down`

Default: null  
Type: String OR Integer OR null

Downstream bandwidth capacity of the host.

Overrides any default bandwidth values set in the assigned topology node.

#### `host_defaults.bandwidth_up`

Default: null  
Type: String OR Integer OR null

Upstream bandwidth capacity of the host.

Overrides any default bandwidth values set in the assigned topology node.

#### `host_defaults.city_code_hint`

Default: null  
Type: String OR null

City code hint for Shadow's name and routing system.

This hint will be used to assign the host to a node based on the city codes of nodes in the network topology.

#### `host_defaults.country_code_hint`

Default: null  
Type: String OR null

Country code hint for Shadow's name and routing system (ex: "US").

This hint will be used to assign the host to a node based on the country codes of nodes in the network topology.

#### `host_defaults.heartbeat_interval`

Default: "1 sec"  
Type: String OR Integer

Amount of time between heartbeat messages for this host.

#### `host_defaults.heartbeat_log_info`

Default: ["node"]  
Type: Array of ("node" OR "socket" OR "ram")

List of information to show in the host's heartbeat message.

#### `host_defaults.heartbeat_log_level`

Default: "info"  
Type: "error" OR "warning" OR "info" OR "debug" OR "trace"

Log level at which to print host statistics.

#### `host_defaults.ip_hint`

Default: null  
Type: String OR null

IPv4 address hint for Shadow's name and routing system (ex: "100.0.0.1").

This hint will be used to assign the host to a node based on the IP values of nodes in the network topology.

#### `host_defaults.log_level`

Default: null  
Type: "error" OR "warning" OR "info" OR "debug" OR "trace" OR null

Log level at which to print node messages.

#### `host_defaults.pcap_directory`

Default: null  
Type: String OR null

Where to save the pcap files (relative to the host directory).

Logs all network input and output for this host in PCAP format (for viewing in e.g. wireshark).

#### `hosts`

*Required*
Type: Object

The simulated hosts which execute processes. Each field corresponds to a host configuration, with the field name being used as the network hostname.

Shadow assigns each host to a node in the [topology](3.2-Network-Config.md).

#### `hosts.<hostname>.options`

See [`host_defaults`](#host_defaults).

#### `hosts.<hostname>.quantity`

Default: 1  
Type: Integer

Number of hosts to start.

If quantity is greater than 1, each host's hostname will be suffixed with a counter. For example, a host with an id of `host` and quantity of 2 would produce nodes with hostnames `host1` and `host2`.

#### `hosts.<hostname>.processes`

*Required*  
Type: Array

Virtual software processes that the host will run.

#### `hosts.<hostname>.processes[*].args`

Default: ""  
Type: String OR Array of String

Process arguments.

#### `hosts.<hostname>.processes[*].environment`

Default: ""  
Type: String

Environment variables passed when executing this process. Multiple variables can be specified by using a semicolon separator (ex: `ENV_A=1;ENV_B=2`).

#### `hosts.<hostname>.processes[*].path`

*Required*  
Type: String

If the path begins with `~/`, it will be considered relative to the current user's home directory.

#### `hosts.<hostname>.processes[*].quantity`

Default: 1  
Type: Integer

The number of replicas of this process to execute.

#### `hosts.<hostname>.processes[*].start_time`

Default: "0 sec"  
Type: String OR Integer

The simulated time at which to execute the process.

#### `hosts.<hostname>.processes[*].stop_time`

Default: null  
Type: String OR Integer OR null

The simulated time at which to send a SIGKILL signal to the process.
